{"path":"3 - Disciplines/Pentest/Files/Pentest-5-Server-vuln-p2.pdf","text":"Московскийkинститутkэлектроникиkиk математикиkимениkАykНykТихонова Кафедраkинформационнойk безопасностиkкиберфизическихk систем Москваk«{«• Лекцияk•:k Серверныеkуязвимостиkвебxприложенийk Частьk«:kАутентификацияkиkавторизация Курс:kТехнологииkпентестингаk Автор:kКосмачевkАлексейkАлексеевичk Планkлекции « ПланkлекцииКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« }y Основныеkпонятияk «y Атакиkнаkаутентификациюk »y Сессииk —y JSONkWebkTokensksJWTt » Этапыkпроведенияkтестированияkнаk проникновение Кафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« 1. Разведка 2. Сбор информации 3. Поиск уязвимостей 4. «Пробив» периметра 5. Закрепление 6. Повышение привилегий 7. Внутренняя разведка 8. Боковое перемещение 9. Реализация критического события Основныеkпонятия — ОсновныеkпонятияКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« • ОсновныеkпонятияКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Идентификацияwkаутентификацияwkавторизация • Идентификацияk—kпроцедураwkвkрезультатеk выполненияkкоторойkдляkсубъектаkидентификацииk выявляетсяkегоkидентификаторwkоднозначноk определяющийkэтогоkсубъектаkвkинформационнойk системеyk • Аутентификацияk—kпроцедураkпроверкиk подлинностиwkнапримерkпроверкаkподлинностиk пользователяkпутемkсравненияkвведенногоkимk пароляkсkпаролемwkсохраненнымkвkбазеkданныхyk • Авторизацияk—kпредоставлениеkопределенномуk лицуkилиkгруппеkлицkправkнаkвыполнениеk определенныхkдействийy 6 ОсновныеkпонятияКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Идентификацияwkаутентификацияwkавторизация Паспорт Идентификацияk sПредъявлениеkпаспортаt Аутентификацияk sПроверкаkналичияkбилетаt Авторизацияk sВозможностьkзанятьkсвоеkместоt 7 ОсновныеkпонятияКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Идентификацияwkаутентификацияwkавторизация https:zzhabrycomzruzarticlesz7«{8—«z 8 ОсновныеkпонятияКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« СессииkиkJWT Критерий Сессии JSONkWebkTokensksJWTt Местоkхраненияk состояния СервернаяkпамятьkилиkхранилищеksБДt КлиентскаяkсторонаkslocalStoragewkcookiest Масштабируемость Требуетkсинхронизацииkсессийkмеждуkсерверами Statelessk—kнеkтребуетkхраненияkсостоянияkнаkсервере Производительность Запросыkкkхранилищуkдляkпроверкиkсессии БыстраяkпроверкаkподписиkтокенаkбезkзапросовkкkБД Межсерверноеk взаимодействие Сложноkиспользоватьkвkмикросервиснойkархитектуре Идеальноkдляkмикросервисовksсамодостаточныйkтокенt Отзыв Легкоkотозватьkчерезkсерверksудалениеkсессииt Сложнееkотозватьksтребуютсяkчерныеkспискиkилиk короткиеkTTLt Атакиkнаkаутентификацию 9 АтакиkнаkаутентификациюКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« }{ АтакиkнаkаутентификациюКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Аутентификацияkиkфакторы • Аутентификацияk—kэтоkпроцессkподтвержденияk личностиkпользователяkилиkклиентаykВебxсайтыk потенциальноkуязвимыkдляkлюбогоwkктоkподключенkкk интернетуykПоэтомуkнадежныеkмеханизмыk аутентификацииkявляютсяkнеотъемлемойkчастьюk эффективнойkвебxбезопасностиy Аутентификацияkимеетkразныеkколичестваksдвухxk трехxфакторнаяkаутентификацияkиkтyдytkиkтипыk факторов:k }y ЗнаниеksKnowledgetkxkчтоxтоwkчтоkтыkзнаешьk sпарольwkответkнаkсекретныйkвопросtk «y ВладениеksPossessiontkxkчтоxтоwkчемkтыkвладеешьk sтелефонwkфизическийkтокенtk »y СвойствоksInherencetkxkчтоxтоwkчтоkявляется частью тебяksбиометрияwkхарактерkповеденияt }} АтакиkнаkаутентификациюКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Возможноеkвлияние • ЗахватkаккаунтаksAccountkTakeoverwkATOtk • Кражаkперсональныхkданныхk • Повышениеkпривилегийkвkприложенииk • ПовышениеkшансовkнаkRCE }« АтакиkнаkаутентификациюКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Passwordxbasedklogin:kметодыkатаки }y Использованиеkслабыхkпаролейkиkпаролейkпоkумолчаниюk admin:admink postgres:postgresk root:rootk tomcat:tomcat Защита:kk • Проверкаkсложностиkпароляk • Сменаkпаролейkпоkумолчанию }» АтакиkнаkаутентификациюКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Passwordxbasedklogin:kметодыkатаки «ykCredentialkStuffingkxkпереиспользованиеkпарkлогинx парольwkmслитыхmkвkоткрытыхzзакрытыхkисточниках Защита:kk • Регулярнаяkсменаkпаролей }— АтакиkнаkаутентификациюКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Passwordxbasedklogin:kметодыkатаки »ykUsernamekEnumerationkxkвозможностьkопределитьk существованиеkпользователяkвkсистемеkисходяkиз:k • Различныхkтекстовkответаkприложенияk • Различныхkкодовkответаk • Незначительныхkопечатокkвk«одинаковых»kответахk приложенияk • Разногоkвремениkответаkприложения Защита:kk • Возвращениеkодинаковогоkответаkвнеk зависимостиkотkсуществованияk пользователяkвkсистеме }• АтакиkнаkаутентификациюКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Passwordxbasedklogin:kметодыkатаки —ykПереборkлогиновzпаролейksBruteforcet Методkзащиты Вариантkобхода БлокировкаkпоkIP • Сбросkсчетчикаkпутемkвходаkвkвалидныйkаккаунтk • МаскировкаkнастоящегоkIPxадресаksнапрykXxForwardedxFortk • Использованиеkраспределеннойkсистемыkперебора Блокировкаkучетнойkзаписи СоздаетkвозможностьkUserkEnumerationk ДелаетkвозможнымkмножественнуюkблокировкуkУЗ CAPTCHA ЭксплуатацияkмисконфигурацийkCAPTCHAksмодификацияwk переиспользованиеwkигнорированиеkиkпрyt }6 АтакиkнаkаутентификациюКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Passwordxbasedklogin:kметодыkатаки •yk«Умный»kпереборkxkэксплуатацияkособенностейkязыковk программированияkиkтехнологийwkиспользуемыхkвk приложенииk Примеры:k • Вkнекоторыхkслучаяхkмыkможемkотправитьkнеkодинk парольwkаkмассивkпаролейwkкаждыйkизkкоторыхkбудетk проверятьсяkприложениемk • ВkGraphQLkсуществуютkалиасыwkсkпомощьюkкоторыхk можноkперебратьkнесколькоkзначенийkоднимkзапросом {\"login\":\"admin\",\"password\":[\"1234\",\"admin\"]} }7 АтакиkнаkаутентификациюКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Passwordxbasedklogin:kметодыkатаки 6ykПереборkвkбазовойkаутентификацииksBasickAuthenticationt Защита:kk • Отказатьсяkотkбазовойkаутентификации Authorization: Basic YWRtaW46YWRtaW4= Base6—xdecode admin:admin }8 АтакиkнаkаутентификациюКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« ClientxSidekAuthentication sТакkделатьkнеkнужноkникогдаt ClientxSidekаутентификация РядовойkAppSec }9 АтакиkнаkаутентификациюКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Мультифакторнаяkавторизация:kметодыkатаки }ykСлабыйkгенераторkOTPksOnekTimekPasswordtk sнапрykСтандартныйkRandomkвkJAVAt Защита:kk • Использованиеkнадежныхkприложенийk sнапрykGooglekAuthenticatortkиkфункцийkдляk генерацииkOTP SEED = 123123 rand(SEED) = one_string rand(SEED) = one_string SEED = 123123 rand(SEED) = one_string rand(SEED) = another_string Слабыйkгенератор: Болееkнадежныйkгенератор: «{ АтакиkнаkаутентификациюКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Мультифакторнаяkавторизация:kметодыkатаки «ykНекорректноеkсостояниеkсессии Защита:kk • Корректныйkконтрольkсостоянияkсессии Гость Пройденk}kфактор Пройденыkобаkфактора «} АтакиkнаkаутентификациюКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Мультифакторнаяkавторизация:kметодыkатаки »ykAccountkHijack Защита:kk • ПривязкаkOTPkкkидентификаторуk • Изменениеkлогики https://example.com/2nd-stage?id=2 «« АтакиkнаkаутентификациюКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Мультифакторнаяkавторизация:kметодыkатаки —ykПереборkOTPksBruteforcet Методkзащиты Вариантkобхода Инвалидацияkвременнойkсессии Автоматизацияkпрохожденияkпервогоkфактора ИнвалидацияkOTPkпослеkNk неверныхkпопыток ЗапросkновогоkкодаkиkпереборkNkпервыхkкодовkk sвероятностныйkподходt Прочиеkтехникиkзащитыkиkобходаkизkатакkнаkаутентификацию «» АтакиkнаkаутентификациюКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Мультифакторнаяkавторизация:kметодыkатаки •ykFlood Защита:kk • ЛимитkнаkотправкуkOTP AccesskCode:k}»»7 AccesskCode:k6•7» AccesskCode:k«7•— AccesskCode:k{6»8 AccesskCode:k997» AccesskCode:k67}9 AccesskCode:k889— AccesskCode:k»•{« AccesskCode:k—6«» AccesskCode:k7—{{ AccesskCode:k88{{ AccesskCode:k8«67 AccesskCode:k68}« AccesskCode:k•—88 AccesskCode:k7•«9 «— АтакиkнаkаутентификациюКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Прочиеkмеханизмыkаутентификации:kk Кастомнаяkаутентифиакационнаяkcookie }y Cookiekguessingkxkподменаzугадываниеzподборk «y Insecurekdeserialization «• АтакиkнаkаутентификациюКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Прочиеkмеханизмыkаутентификации:kk Восстановлениеkпароля }y Tokenkguessingkxkслабаяkэнтропияkилиkлогическиеkошибкиk «y SQLikUltimatekPowerkxkлегкийkATOkчерезkSQLiksпочему?tk »y HostkHeaderkattacksk —y Exotickexploitskseygykdanglingkmarkupkinjectiontk •y UserkEnumk 6y Flood «6 АтакиkнаkаутентификациюКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Прочиеkмеханизмыkаутентификации:kk Сменаkпароля }y BrokenkAccesskControlksсменаkпароляkдругомуkпользователюtk «y LogickFlawsksпереборkпароляkбезkблокировкиkУЗtk »y PrototypekPollutionksServerxSidetk —y MasskAssignment «7 АтакиkнаkаутентификациюКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Прочиеkмеханизмыkаутентификации:kk КастомнаяkCAPTCHA }y CAPTHCAkguessingksугадываниеwkполучениеkответаkотk приложенияtk «y CAPTCHAkmodifyksзаменаkзначенияkнаkнеобходимоеtk »y CAPTCHAkreuseksпереиспользованиеkCAPTCHAtk —y CAPTCHAkDoSksвозможностьkиспортитьkединичнуюk CAPTCHAkилиkгруппуkпоkидентификаторwkделаяk невозможнымkееkправильныйkвводt «8 АтакиkнаkаутентификациюКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Прочиеkмеханизмыkаутентификации:kk Регистрация }y MasskAssignmentk «y PrototypekPollutionksServerxSidet Сессии «9 СессииКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« »{ СессииКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Определение • Сессия (Session)k—kэтоkмеханизмwkкоторыйk позволяетkсерверуkсохранятьkинформациюkоk взаимодействииkсkконкретнымkпользователемkвk течениеkопределенногоkпериодаkвремениksпокаk пользовательkактивенkнаkсайтеtykk Прощеkговоряwkэтоkспособkmпомнитьmkпользователяk междуkотдельнымиkHTTPxзапросамиyk Наkсторонеkсервераwkидентификаторуkсессииk присваиваютсяkатрибутыksсвойстваwkсостоянияtkk Клиент Сервер SessionID Атрибутk} Атрибутk« »} СессииКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« SessionkFixation Фиксация Сессии (Session Fixing)kпозволяетk злоумышленникуkперехватитьkдействующийkсеансk пользователяykПричинаkуязвимостиkвkспособеkуправленияk идентификаторомkсеансаkвебxприложенияyk • Атакующийkможетkполучитьkидентификаторkсессииkиk отправитьkжертвеykПослеkтогоwkкакkжертваk аутентифицируетсяkвkсистемеwkатакующийkполучитk валиднуюkсессиюkжертвыk Атакаkреализуетсяwkеслиkвыполняютсяkобаkусловия:k }y Приложениеkнеkвыдаетkновогоkидентификатораk сессииkпослеkуспешнойkаутентификацииkпользователяk «y Атакующийkможетkвыставитьkжертвеkидентификаторk сессииksчерезkclientxsidekуязвимостьkилиkинымиk способамиt }ykПолучениеkSessionId «ykОтправкаk SessionIdk жертве »wkА ут ентификация k ж ер твы —ykПолучениеkдоступа Защита:kk • ВыдачаkновогоkSessionIDkпослеkаутентификации »« СессииКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« SessionkPuzzling Session Puzzling (Session Variable Overloading)k—k уязвимостьwkкотораяkвозникаетwkкогдаkпеременнаяk сеансаkприложенияkиспользуетсяkдляkболееkодногоk назначенияyk • Вkрезультатеkэксплуатацииkатакующийkполучаетk доступkкkсвойствамkсессииkдругогоkпользователяkk Защита:kиспользоватьkпеременнуюkсеансаkтолькоkдляk одногоkназначения }ykПолучениеkгостевойkSessionId «ykПопыткаkвосстановленияk пароляkадминистратора »ykПолучениеk свойствkсессииk администратора •ykД оступ kк kzadmin —ykС м ена kс осто яния k с ес сии »» СессииКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« ImproperkSessionkInvalidation • Послеkвыходаkизkаккаунтаkсессияkостаетсяk валиднойk • Еслиkсессияkбудетkукраденаwkтоkнетkспособаk сделатьkееkневалиднойkкромеkпрямогоk вмешательстваk Защита:kкорректнаяkинвалидацияkсессииkпослеk выходаkизkаккаунтаkилиkпоkистеченииkвремени JSONkWebkTokensksJWTt »— JSONkWebkTokensksJWTtКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« »• JSONkWebkTokensksJWTtКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Определение • JSON Web Tokens (JWT) xk стандартизированныйkформатkдляkпередачиk криптографическиkподписанныхkданныхkJSONk междуkсистемамиykТеоретическиkониkмогутk содержатьkлюбыеkданныеwkноkчащеkвсегоk используютсяkдляkпередачиkинформацииk s«claims»tkоkпользователяхkвkрамкахk механизмовkаутентификацииwkуправленияk сеансамиkиkконтроляkдоступаy https:zzwwwyjwtyioz »6 JSONkWebkTokensksJWTtКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Структура eyJhbGciOiJIUzI}NiIsInR•cCI6Ikp XVCJ9yeyJzdWIiOiIxMjM{NTY»O DkwIiwibmFtZSI6IkpvaG—gRG9lIiw iYWRtaW—iOnRydWUsImlhdCI6M TUxNjIzOTAyMn{yKMUFsIDTnFmy G»nMiGM6H9FNFUROf»wh7Sm qJpxQV»{ Base6—xdecode {k kkmalgm:kmHS«•6mwk kkmtypm:kmJWTmk }k {k kkmsubm:km}«»—•6789{mwk kkmnamem:kmJohnkDoemwk kkmadminm:ktruewk kkmiatm:k}•}6«»9{««k }k <signature> »7 JSONkWebkTokensksJWTtКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« JWTkvskJWSkvskJWE JWT (JSON Web Token) JWS (JSON Web Signature) JWE (JSON Web Encryption) sExtendst • Базовыйkформатkпередачиk данных • СтандартkподписиkJWTkприk помощиkсекретногоsxыхtk ключаsxейtk • Обычно имеют в виду именно это, когда говорят о JWT • СтандартkшифрованияkPayloadx частиk • Обычноkимеетkформатk headeryencrypted_keyyivycipherte xtytag »8 JSONkWebkTokensksJWTtКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Симметричныеkиkасимметричныеkалгоритмыkподписи JWT• СимметричныйksHS«•6kxk HMACvSHA«•6tkxkодинkключk используетсяkиkдляkподписиwkиkдляk проверкиkподписи подпись проверка JWT • АсимметричныйksRS«•6kxk RSAvSHA«•6tkxkзакрытыйkключk используетсяkдляkподписиwkоткрытыйk xkдляkпроверкиkподписи подпись проверка закрытыйkключ открытыйkключ »9 JSONkWebkTokensksJWTtКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« AccesskиkRefreshxтокены • Способkуправленияk«долгосрочной»kавторизациейk пользователяk • ВkUIkобычноkбудетkпримененkпослеkнажатияkкнопкиk «запомнитьkменя»k • Идея:kприkаутентификацииkвыдаетсяkдваkтокена:kAccesskиk Refreshk • Токеныkпомещаютсяkвkразныеkместаkиkимеютkразныйkсрокk жизниk • AccesskTokenkимеетkкороткийkсрокkжизниkиkиспользуетсяk дляkавторизацииk • RefreshkTokenkимеетkдолгийkсрокkжизниkиkиспользуетсяkдляk полученияkновойkпарыkAccesskиkRefreshxтокеновk • УтечкаkRefreshxтокенаkнесетkсерьезныйkущерб —{ JSONkWebkTokensksJWTtКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« АтакиkнаkJWT:kвлияние • Сильныйkконтрольkнадkприложениемk • Обходkаутентификацииk • Повышениеkпривилегийkвнутриkприложенияk • AccountkTakeoverksATOtk • Представлениеkдругимkпользователемk • Векторkдляkдругихkатак —} JSONkWebkTokensksJWTtКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« АтакиkнаkJWT:kотсутствиеkпроверкиkподписи • Вместоkметодаkverifystkиспользуетсяkметодk decodestk • Подписьkнеkпроверяетсяk • Можноkзаписыватьkлюбыеkданныеk Защита:kпроверятьkподписьkJWT token.decode() token.verify() —« JSONkWebkTokensksJWTtКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« АтакиkнаkJWT:kподдержкаkалгоритмаknone • Приложениеkполностьюkдоверяетkтокенуkотk клиентаksпринципkJWTtk • Приложениеkнеkограничиваетkиспользуемыеk алгоритмыk • Происходитkзаменаkнаkалгоритмknonekиk подписьk«отрезается»wkоставляяkприkэтомk завершающуюkточкуk Защита:kотключитьkподдержкуkалгоритмаknone { \"alg\": \"HS256\", \"typ\": \"JWT\" } { \"alg\": \"none\", \"typ\": \"JWT\" } СтруктураkJWT:kheaderypayloady —» JSONkWebkTokensksJWTtКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« АтакиkнаkJWT:kпереборkключейkHS«•6 • АлгоритмkHS«•6kxkсимметричныйk • Еслиkиспользуетсяkслабыйkключwkегоkможноk эффективноkподобратьk Защита:kиспользоватьkнадежныеkключи { \"alg\": \"HS256\", \"typ\": \"JWT\" } hashcat -a 0 -m 16500 <jwt> <wordlist> https:zzgithubycomzwallarmzjwtxsecretszblobzmasterzjwtysecretsylistk hashcat -a 0 -m 16500 <jwt> <wordlist> --show —— JSONkWebkTokensksJWTtКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« JWKwkJKUwkKID • jwk (JSON Web Key)kxkформатkпредставленияkключаkвk JSONxформатеk • jku (JSON Web Key Set URL)kxkссылкаwkпоkкоторойk можноkполучитьkмножествоkключейkиkвыбратьkизkнихk необходимыйk • kid (Key ID)kxkидентификаторwkпозволяющийkоднозначноk определитьkключkизkмножестваykВkнекоторыхkслучаяхk позволяетkуказатьkпутьkдоkфайлаkсkключом —• JSONkWebkTokensksJWTtКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« АтакиkнаkJWT:kиспользованиеkсамоподписанногоkключаksjwkt }y Приложениеkиспользуетk асимметричныйkалгоритмksRS«•6tk «y Атакующийkгенерируетkпаруkключейk »y АтакующийkподписываетkJWTk собственнымkприватнымkключомwkаk публичныйkпомещаетkвkтокенkвkjwkk —y Приложениеkиспользуетkключkизkjwkk дляkпроверкиkподписиk=>kдоверяетk токенуkk Защита:kиспользоватьkбелыйkсписокk публичныхkключейkдляkпроверки { \"kid\": \"ed2Nf8sb-sD6ng0-scs5390g-fFD8sfxG\", \"typ\": \"JWT\", \"alg\": \"RS256\", \"jwk\": { \"kty\": \"RSA\", \"e\": \"AQAB\", \"kid\": \"ed2Nf8sb-sD6ng0-scs5390g-fFD8sfxG\", \"n\": \"yy1wpYmffgXBxhAUJzHHocCuJolwDqql75ZWuCQ_cb33K2vh9m\" } } —6 JSONkWebkTokensksJWTtКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« АтакиkнаkJWT:kиспользованиеkсамоподписанногоkключаksjkut }y Приложениеkиспользуетkасимметричныйk алгоритмksRS«•6tk «y Атакующийkгенерируетkпаруkключейk »y АтакующийkподписываетkJWTk собственнымkприватнымkключомwkаk публичныйkпомещаетkвkJWKkSetkнаk своемkсервереk —y Вkпараметреkjkukуказываетсяkссылкаkнаk JWKkSetwkаkтакжеkизменяетсяkkidk •y ПриложениеkиспользуетkключkизkJWKk SetwkрасположенныйkпоkURLkизkjkukдляk проверкиkподписиk=>kдоверяетkтокенуkk Защита:kприниматьkключиkтолькоkизk доверенныхkисточников { \"keys\": [ { \"kty\": \"RSA\", \"e\": \"AQAB\", \"kid\": \"75d0ef47-af89-47a9-9061-7c02a610d5ab\", \"n\": \"<some_val>\" }, { … } ] } { \"jku\":\"https://exploit.domain/keys.txt\", \"kid\":\"75d0ef47-af89-47a9-9061-7c02a610d5ab\",... } —7 JSONkWebkTokensksJWTtКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« АтакиkнаkJWT:kиспользованиеkсамоподписанногоkключаkskidt }y Приложениеkиспользуетkсимметричныйk алгоритмksHS«•6tk «y Вkзначениеkkidkможноkуказатьkпутьkдоk файлаk »y Атакующийkможетkподписатьkтокенk любымkфайломwkеслиkзнаетkегоk содержимоеk —y Можноkиспользоватьkzdevznullkиk подписатьkпустымkключомk •y ТакжеwkвозможнаkэксплуатацияkSQLik черезkданныйkпараметрk Защита:kнеkпозволятьkприниматьk произвольныйkпуть;kзащититьсяkотkSQLi { \"kid\":\"/dev/null\", … } —8 JSONkWebkTokensksJWTtКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« АтакиkнаkJWT:kalgorithmkconfusion Идея:kсменаkассиметричногоkалгоритмаkнаk симметричныйykВkкачествеkподписиk использоватьkпубличныйkключyk Этапыkэксплуатации:k }y Получениеkпубличногоkключа:k xkвkпубличноkдоступныхkдиректорияхk xkвычислитьkнаkосновеkвыданныхkтокеновk «y ПереводkвkнеобходимыйkформатksJWKwk Xy•{9kPEMwkиkтyдytkxkключkдолженk побайтовоkсовпадатьkсkимеющимсяkнаk сервереk »y СозданиеkJWTkсkalgkHS«•6wkподписьk токенаkполученнымkключомk /jwks.json /.well-known/jwks.json … docker run --rm -it portswigger/sig2n <token1> <token2> https://github.com/silentsignal/rsa_sign2n (jwt_forgery.py) Защита:kk • Проверкаkсоответствияkиспользуемомуkалгоритму —9 JSONkWebkTokensksJWTtКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« JWTkInvalidation ТакkкакkJWTkxkStatelessksнеkимеетkсостоянияk наkсторонеkсервераtkсуществуютkпроблемыkвk егоkинвалидацииyk Некоторыеkспособы:k • Указаниеkоченьkкороткогоkвремениkжизниk • Черныйkсписокkневалидныхkтокеновk • Механизмыkинвалидацииkтокеновkпоk идентификаторуksнужныkтриггерыwk напримерwkповторноеkиспользованиеk refreshxтокенаtkk • Сменаkключаkподписиksрадикальныйkметодtkk Защита:kk • Проверкаkсоответствияkиспользуемомуkалгоритму •{ JSONkWebkTokensksJWTtКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk« Дополнительныеkматериалыkдляkизучения }y OauthkqkOpenIDkConnectksvметодыkатакtk «y ИнъекцияkсертификатовkXy•{9kвkJWTksCVEx«{}7x«8{{wkCVEx«{}8x«6»»t •} ФиналКафедраkинформационнойk безопасностиkкиберфизическихk систем Лекцияk•:kСерверныеkуязвимостиk вебxприложенийykЧастьk«","libVersion":"0.5.0","langs":""}